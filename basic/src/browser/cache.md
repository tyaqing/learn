# 缓存

## 浏览器缓存

这里说的缓存是指浏览器（客户端）在本地磁盘中对访问过的资源保存的副本文件。

浏览器缓存主要有以下几个优点(从客户端,服务端,网络 3 方面说)：

- 减少重复数据请求，避免通过网络再次加载资源，节省流量。
- 降低服务器的压力，提升网站性能。
- 加快客户端加载网页的速度， 提升用户体验。

## 缓存分类

1. 浏览器首先根据资源的 http 头信息判断是否命中强缓存,如果命中,就不用发请求到服务器,就到本地拿缓存文件.
2. 如果没有命中强缓存,浏览器就会发送请求到服务器,服务器来判断浏览器的本地缓存是否失效,若可以使用,服务器不会返回资源,浏览器继续从本地加载资源
3. 如果没有命中协商缓存,服务器就会完整返回资源给浏览器,浏览器加载资源,并更新缓存.

### 强缓存

命中强缓存,返回 200,size 显示(from cache)
强缓存是利用 Expire 或者 Cache-CControl 来控制
都是由服务端配置,如 nginx

`Expire`:缓存过期时间,是服务器的具体时间点.是绝对时间,有一个明显的缺点,当客户端本地时间更改

`Cache-Control`:是一个相对时间,同时启用,Cache-Control 优先级更高

### 协商缓存

浏览器问服务器,我缓存的文件有没有更新

1. 没有更新,304,从缓存取
2. 更新了,重新从服务器拉取

`Last-Modified`:第一次请求服务器资源时,在响应头中,表示为资源最后修改时间

`If-Modify-Since`:当浏览器再次请求,在发送的请求头中,值与 Last-Modified 相等,服务器收到后,会根据最后修改时间判断是否命中缓存;如果命中返回 304,并且不会返回 Last-Modified.

`Etag/If-None-Match`:保证每个资源是唯一的,资源变化都会导致 Etag 变化.服务器根据浏览器发送过来的 If-None-Match 来判断是否命中缓存

## 术语

- 缓存命中率
- 过期内容
- 验证
- 失效
